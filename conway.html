<!--
An implementation of Conway's Game of Life using HTML5 Canvas

By default, it will generate a random board with each cell having a
0.1 probability of being alive (see variable "prob" below).

The default delay is 10 milliseconds (see variable "delay" below).

This is ready to run, and will do so if you save it and then open it
in your browser of choice.
-->
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Canvas tutorial template</title>
    <script type="text/javascript">

      var block_size = 3; // x and y dimension of each block
      var cols = 150; // number of columns
      var rows = 150; // and rows 
      var canvas_height = block_size * rows;
      var canvas_width = block_size * cols;

      // initial probability of a space being filled
      var prob = 0.1;

      // delay between frames in milliseconds
      var delay = 10;

      function draw(){
        // drawing logic
        var canvas = document.getElementById('matrix');
        if (canvas.getContext){
          var ctx = canvas.getContext('2d');
        }
        ctx.clearRect(0, 0, canvas_height, canvas_width); // clear canvas
        for (row = 0; row < rows; row++) {
          for (col = 0; col < cols; col++) {
            if (blocks[row][col]) {
              ctx.fillRect(col * block_size, row * block_size, block_size, block_size);
            }
          }
        }
        // Conway logic
        // new array so that changes don't affect future changes
        var old_blocks = [];
        for (i = 0; i < blocks.length; i++) {
          old_blocks[i] = blocks[i].slice();
        }
        for (row = 0; row < rows; row++) {
          for (col = 0; col < cols; col++) {
            var count = 0; // stores number of neighbors
            // these four variables determine which neighbors don't exist
            // that prevents us from going out of bounds in the array
            var topRow = (row == 0) ? true : false; 
            var bottomRow = (row == rows-1) ? true : false;
            var topCol = (col == 0) ? true : false;
            var bottomCol = (col == cols-1) ? true : false;
            // test for all eight neighbors if they exist
            if (!bottomRow && old_blocks[row+1][col])
              count++;
            if (!bottomRow && !bottomCol && old_blocks[row+1][col+1])
              count++;
            if (!bottomRow && !topCol && old_blocks[row+1][col-1])
              count++;
            if (!bottomCol && old_blocks[row][col+1])
              count++;
            if (!topRow && !bottomCol && old_blocks[row-1][col+1])
              count++;
            if (!topCol && old_blocks[row][col-1])
              count++;
            if (!topRow && old_blocks[row-1][col])
              count++;
            if (!topRow && !topCol && old_blocks[row-1][col-1])
                count++;
            // conditionally change state of block based on Conway's rules
            if (count < 2 || count > 3)
              blocks[row][col] = false;
            else if (count === 3)
              blocks[row][col] = true;
          }
        }
      }

      function play() {
        // initialize the blocks
        blocks = new Array(rows); 
        for (row = 0; row < rows; row++) {
          blocks[row] = new Array(cols);
          for (col = 0; col < cols; col++) {
            // random generator
            if (Math.random() < prob)
              blocks[row][col] = true;
            else blocks[row][col] = false;

            /* creates a glider, used as test case

            if (row == 4 && col == 3) blocks[row][col] = true;
            else if (row == 4 && col == 4) blocks[row][col] = true;
            else if (row == 4 && col == 5) blocks[row][col] = true;
            else if (row == 3 && col == 5) blocks[row][col] = true;
            else if (row == 2 && col == 4) blocks[row][col] = true;
            else blocks[row][col] = false; */
          } 
        } 
        // call animation loop
        setInterval(draw, delay); 
      }

    </script>
  </head>
  <body onload="play();">
  <script type="text/javascript">
    // make a canvas of dynamic size
    document.write("<canvas id='matrix' height='" + canvas_height + "' width='" + canvas_width + "'></canvas>");
  </script>
  </body>
</html>
